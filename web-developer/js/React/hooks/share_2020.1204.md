# react hooks æœ€ä½³å®è·µ
[TOC]

## wanan
1. é€šè¿‡åœºæ™¯åˆ†æä½¿ç”¨ä»€ä¹ˆæ ·çš„hooks
2. é‡åˆ°é—®é¢˜æ—¶ï¼Œæ˜¯æ€ä¹ˆé€ æˆçš„ï¼Œç”¨å“ªä¸ªhooksåŠæ€ä¹ˆç”¨å¯ä»¥è§£å†³ï¼Ÿ

### æ´¾ç”Ÿstate
æ— å­ç»„ä»¶çŠ¶æ€
key
å­ç»„ä»¶ä¿ç•™ä¸Šä¸€æ¬¡ç”Ÿæ•ˆçš„å€¼ï¼ˆuseRefï¼‰

### useEffect
åœ¨effect ä¸­ä½¿ç”¨äº†å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨

### useCallback


## what
hooks è§£å†³æ–¹æ¡ˆ
- æ— é‡å¤§å˜åŒ–ï¼Œæ²¡æœ‰ç ´åæ€§æ”¹åŠ¨ï¼Œå®Œå…¨å‘åå…¼å®¹
- é€æ­¥é‡‡ç”¨çš„ç­–ç•¥ï¼Œå¯é€‰ï¼Œç°åœ¨å¯ç”¨
  
åœ¨Hookså‡ºç°ä¹‹å‰ï¼Œå‡½æ•°ç»„ä»¶åªèƒ½æ˜¯çº¯ç»„ä»¶ï¼Œæ— æ³•æ»¡è¶³ç§æœ‰çŠ¶æ€ä»¥åŠå‰¯ä½œç”¨çš„åœºæ™¯ã€‚

Hookså‡ºç°ä¹‹åï¼Œç±»ç»„ä»¶å¯ä»¥åšçš„äº‹æƒ…ï¼Œå‡½æ•°ç»„ä»¶åŸºæœ¬å¯ä»¥æ»¡è¶³ï¼Œç”šè‡³æ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚


- ç»™å‡½æ•°å¼ React ç»„ä»¶æ³¨å…¥çŠ¶æ€çš„ React API

## why need hooks?
è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå¸¦æ¥äº†ä»€ä¹ˆå½±å“

### é—®é¢˜
- éš¾ä»¥åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨æœ‰çŠ¶æ€é€»è¾‘
  - åŒ…è£…å™¨åœ°ç‹±
    - Providerã€Consumerã€hocã€render prop å’Œå…¶ä»–æŠ½è±¡ç»„ä»¶å½¢æˆçš„
      - ä½¿ç”¨hoc, refçš„é—®é¢˜ (forwardRef)
- å¤æ‚çš„ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£
  - å¤§é‡çŠ¶æ€é€»è¾‘ã€å‰¯ä½œç”¨ç­‰
  - ç”Ÿå‘½å‘¨æœŸ
    - åŒä¸€ç”Ÿå‘½å‘¨æœŸå†…å……æ–¥ç€ä¸ç›¸å¹²é€»è¾‘
      - è®¢é˜…äº‹ä»¶ã€å‘é€è¯·æ±‚
    - å…³è”é€»è¾‘è¢«æ‹†åˆ†åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸ
      - æ³¨å†Œã€è§£ç»‘
    - çŠ¶æ€ã€é€»è¾‘è¶Šæ¥è¶Šå¤šï¼Œå®¹æ˜“å¯¼è‡´ä¸ä¸€è‡´ï¼Œéšç€ä»£ç é‡è¶Šæ¥è¶Šå¤§ï¼ŒbugğŸ˜­...
  - ä¸çŠ¶æ€ç®¡ç†åº“ç»“åˆï¼Œéœ€è¦åœ¨ä¸åŒçš„æ–‡ä»¶ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œå¤ç”¨ç»„ä»¶ä¸ä¾¿
    - redux, reducer...
- éš¾ä»¥ç†è§£çš„ class
  - this / äº‹ä»¶å¤„ç†å™¨ bind(=>)
  - class ä¸èƒ½å¾ˆå¥½çš„å‹ç¼©

### ç‰¹ç‚¹
- å…±äº«çŠ¶æ€é€»è¾‘
  - æå–
    - æŠ½è±¡ï¼ˆè¡¨è¾¾ï¼‰
  - ç‹¬ç«‹æµ‹è¯•
  - å¤ç”¨
    - æ— éœ€ä¿®æ”¹ç»„ä»¶ç»“æ„ -> è‡ªå®šä¹‰ç»„ä»¶
    - ç¤¾åŒº hooks
    - å‡å°‘ä»£ç å®ç°ï¼›
- æ›´å°ç²’åº¦
  - ç›¸äº’å…³è”çš„éƒ¨åˆ†ï¼Œè¢«æ‹†åˆ†æ›´å°çš„å‡½æ•°ï¼Œä¸”éå¼ºåˆ¶æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†
    - åˆ›å»ºè®¢é˜…åŠå–æ¶ˆè®¢é˜…
- æ‹¥æŠ±å‡½æ•°


### è§£å†³çš„æœ€å¤§ç—›ç‚¹
  - æ‹†å°ç»„ä»¶
    - åˆ†æ²»
  - æŠ½è±¡ï¼ˆè¡¨è¾¾ï¼‰
  - å¤ç”¨
  - ç»„åˆ
    - å…±äº«é€»è¾‘ï¼Œå¯ä»¥å°†é€»è¾‘è§£è€¦ã€‚

å…¶ä»–ç—›ç‚¹ï¼š


### Hooks æœ€å¤§çš„ç¼ºç‚¹ï¼š
é—­åŒ…

å‡½æ•°çš„è¿è¡Œæ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä»½ç‹¬ç«‹çš„ä½œç”¨åŸŸã€‚å‡½æ•°çš„å˜é‡æ˜¯ä¿å­˜åœ¨è¿è¡Œæ—¶çš„ä½œç”¨åŸŸé‡Œé¢ï¼Œå½“æˆ‘ä»¬æœ‰å¼‚æ­¥æ“ä½œçš„æ—¶å€™ï¼Œç»å¸¸ä¼šç¢°åˆ°å¼‚æ­¥å›è°ƒçš„å˜é‡å¼•ç”¨æ˜¯ä¹‹å‰çš„ï¼Œä¹Ÿå°±æ˜¯æ—§çš„ï¼ˆè¿™é‡Œä¹Ÿå¯ä»¥ç†è§£æˆé—­åŒ…ï¼‰å¦‚ä¸‹ï¼š

React Hooks ç”±äºæ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆ–è€…ä½¿ç”¨ useCallBackã€useEffectã€useMemo ç­‰ API æ—¶ä¼šå½¢æˆé—­åŒ…ã€‚



## Hook çš„è§„åˆ™
Hook æ˜¯ JavaScript å‡½æ•°ï¼Œä½†å¼ºåŠ äº†ä¸¤ä¸ªé¢å¤–çš„è§„åˆ™ï¼š
- åªèƒ½åœ¨é¡¶å±‚è°ƒç”¨ Hookï¼Œä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚
  - å®ç°åŸç†ï¼Œä½¿ç”¨é“¾è¡¨æ¥ç»´æŒé¡ºåºï¼Œå½“hooksä¸èƒ½ä¸€ä¸€å¯¹åº”æ—¶ï¼Œä¼šå¯¼è‡´å¼‚å¸¸
  - æ¯ä¸€ä¸ª React Hooks API éƒ½æ˜¯åŒ¿åçš„ï¼Œé‚£è¿™ä¸€æ¬¡æ‰§è¡Œçš„ Hook æ€ä¹ˆè·Ÿä¸Šä¸€æ¬¡æ‰§è¡Œçš„ Hook å¯¹åº”èµ·æ¥ï¼Ÿ
  - å…³é”®ç‚¹æ˜¯é¡ºåºï¼ŒHooks ç»„ä»¶é€šè¿‡è®°å½• Hooks æ‰§è¡Œçš„é¡ºåºæ¥å’Œä¸Šä¸€æ¬¡çš„ Hook ä¸€ä¸€å¯¹åº”çš„ã€‚

- ä»…ä» React å‡½æ•°ç»„ä»¶è°ƒç”¨ Hookã€‚
  - ä¸è¦ä»å¸¸è§„ JavaScript å‡½æ•°è°ƒç”¨ Hookã€‚ï¼ˆè¿˜æœ‰å¦ä¸€ä¸ªæœ‰æ•ˆçš„åœ°æ–¹æ¥è°ƒç”¨ Hookï¼Œå³ä½ çš„è‡ªå®šä¹‰ Hookã€‚ï¼‰
  - è¿™é‡Œï¼ˆhttps://www.npmjs.com/package/eslint-plugin-react-hooksï¼‰æä¾›äº†ä¸€ä¸ª linter æ’ä»¶æ¥è‡ªåŠ¨æ‰§è¡Œè¿™äº›è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ä¹çœ‹èµ·æ¥æœ‰äº›ä»¤äººç–‘æƒ‘ï¼Œä½†å®ƒä»¬å¯¹ Hook çš„è‰¯å¥½è¿è¡Œè‡³å…³é‡è¦ã€‚


## [ä½¿ç”¨hooks ä¸å…ˆå‰çš„è§£å†³æ–¹æ¡ˆå¯¹æ¯”](http://localhost:3000/hooks/compair)
hoc & hooks



è§ /Users/sunny/Documents/workspace/project/note/web-developer/todo/my-app/src/page/compair.jsx

## how: API & ä½¿ç”¨æ¡ˆä¾‹


## è‡ªå®šä¹‰hooks
ç»„ä»¶ä¹‹é—´é‡ç”¨ä¸€äº›çŠ¶æ€é€»è¾‘ï¼š
ç›®å‰ä¸ºæ­¢ï¼Œæœ‰å‡ ç§ä¸»æµæ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š
  - é«˜é˜¶ç»„ä»¶
  - render propsã€‚
  - è‡ªå®šä¹‰ Hook å¯ä»¥è®©ä½ åœ¨ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚

å¯ä»¥åˆ›å»ºæ¶µç›–å„ç§åœºæ™¯çš„è‡ªå®šä¹‰ Hookï¼š
- è¡¨å•å¤„ç†ã€åŠ¨ç”»ã€è®¢é˜…å£°æ˜ã€è®¡æ—¶å™¨

è§£è€¦çŠ¶æ€ç›¸å…³é€»è¾‘



## é¿å‘æŒ‡å—
Reactåœ¨è®¾è®¡å±‚é¢æŠŠå¤§éƒ¨åˆ†çš„ä¼˜åŒ–è´£ä»»éƒ½å¯¹ç»™äº†å¼€å‘è€…ï¼Œä½¿ç”¨Reactä¼šæœ‰ä¸€å®šçš„å¿ƒæ™ºè´Ÿæ‹…ã€‚å½“æˆ‘ä»¬ä½¿ç”¨Hooksçš„æ—¶å€™ï¼Œè¿™æ ·çš„æ„Ÿå—ä¼šæ›´åŠ å¼ºçƒˆã€‚ä½†æ˜¯æ€»ç»“èµ·æ¥ Hooks çš„å¤§éƒ¨åˆ†é—®é¢˜å…¶å®éƒ½è·Ÿé—­åŒ…æˆ–å‰¯ä½œç”¨ä¾èµ–æœ‰å…³ã€‚


### hooks ä½¿ç”¨é¡ºåºå»ºè®®, é¿å…éšæ€§bug
- useEffect
  - å‡½æ•°ä¾èµ–ï¼Œ
    - å°†è¯¥å‡½æ•°æ”¾ç½®åœ¨ effect å†…
    - æ”¾åœ¨ç»„ä»¶å¤–
    - ä½¿ç”¨ useCallback åŒ…è£¹ï¼›
- useEffect/useCallback/useMemo
  - å¯¹äº state æˆ–è€…å…¶ä»–å±æ€§çš„ä¾èµ–ï¼Œæ ¹æ® eslint çš„æç¤ºå¡«å…¥ depsï¼›
- setState
  - ä¸ä¾èµ–å…¶ä»–state
    - ç”¨ setState çš„å‡½æ•°å…¥å‚æ–¹å¼ï¼ˆsetState(c => c + 1)ï¼‰ä»£æ›¿ï¼›
  - ä¾èµ–äº†å…¶ä»–stateï¼Œæ”¹å†™æˆ useReducer çš„å½¢å¼ï¼›
- ä»¥ä¸Šæ–¹æ³•éƒ½ä¸å¥æ•ˆï¼Œä½¿ç”¨ useRef


## ä½“ç³»è®¾è®¡
### [hooks ä½“ç³»è®¾è®¡ä¹‹ä¸€åˆ†å±‚](https://zh-hans.reactjs.org/blog/2020/08/21/react-hooks-extra-level-of-indirection.html)

é‡‘å­—å¡”å½¢çŠ¶ï¼Œè‡ªåº•å‘ä¸Šä¾æ¬¡ä¸ºï¼š
#### æœ€åº•å±‚çš„å†…ç½® hook
ä¸éœ€è¦è‡ªå·±å®ç°ï¼Œå®˜æ–¹ç›´æ¥æä¾›ã€‚

#### ä¸å¯å˜æ›´æ–° immer
ç®€åŒ–çŠ¶æ€æ›´æ–°æ–¹å¼çš„ hookï¼Œæ¯”è¾ƒç»å…¸çš„æ˜¯å¼•å…¥ immerã€‚
ä½¿ç”¨ immer è¿›è¡Œæ›´æ–°ï¼Œåˆ©ç”¨ Proxy çš„ç‰¹æ€§å°†å¯å˜çš„æ•°æ®æ›´æ–°æ˜ å°„ä¸ºä¸å¯å˜çš„æ“ä½œã€‚

##### useImmerState / useImmerReducer

##### çŠ¶æ€ä¸è¡Œä¸º: ç±» userMethods
å¼•å…¥â€œçŠ¶æ€ + è¡Œä¸ºâ€çš„æ¦‚å¿µï¼Œé€šè¿‡å£°æ˜çŠ¶æ€ç»“æ„ä¸ç›¸åº”è¡Œä¸ºå¿«é€Ÿåˆ›å»ºä¸€ä¸ªå®Œæ•´ä¸Šä¸‹æ–‡ã€‚

å‡½æ•°å¼ç¼–ç¨‹ã€ 
todo: é¢å‘å¯¹è±¡çš„å†…åœ¨ç†å¿µæ˜¯ï¼Ÿ
`å°è£…`å’Œ`èŒè´£è¾¹ç•Œåˆ’åˆ†`çš„å½¢æ€

#### æ•°æ®ç»“æ„çš„æŠ½è±¡
å¯¹å¸¸è§æ•°æ®ç»“æ„çš„æ“ä½œè¿›è¡Œå°è£…ï¼Œå¦‚æ•°ç»„çš„æ“ä½œã€‚

#### é’ˆå¯¹é€šç”¨ä¸šåŠ¡åœºæ™¯è¿›è¡Œå°è£…ï¼Œå¦‚åˆ†é¡µçš„åˆ—è¡¨ã€æ»šåŠ¨åŠ è½½çš„åˆ—è¡¨ã€å¤šé€‰ç­‰ã€‚
åœºæ™¯çš„å°è£…ä¸åº”ä¸ç»„ä»¶åº“è€¦åˆï¼Œå®ƒåº”å½“æ˜¯ä¸šåŠ¡ä¸ç»„ä»¶ä¹‹é—´çš„æ¡¥æ¢ï¼Œä¸åŒçš„ç»„ä»¶åº“ä½¿ç”¨ç›¸åŒçš„ hook å®ç°ä¸åŒçš„ç•Œé¢ï¼Œè¿™æ‰æ˜¯ä¸€ä¸ªç†æƒ³çš„æ¨¡å¼


#### å®é™…é¢å‘ä¸šåŠ¡çš„å®ç°


### [hooksçš„ä½“ç³»è®¾è®¡ä¹‹äºŒçŠ¶æ€ç²’åº¦](https://zh-hans.reactjs.org/blog/2020/08/22/react-hooks-state-granularity.html)

ç»„ç»‡å’Œå¯è¯»æ€§

#### ç²’åº¦è¿‡ç»†
æ¯ä¸ªstateç»´æŠ¤ä¸€ä»½ useState

> åšä¸€ä¸ªè¡¨æ ¼ï¼Œå¸¦ä¸€ä¸ªé€‰ä¸­åŠŸèƒ½ï¼Œå…¶ä¸­ä¸€ä¸ªç‚¹æ˜¯â€œæŒ‰ä½ SHIFT çš„åŒæ—¶ç‚¹å‡»ä¸€è¡Œå¯ä»¥é€‰ä¸­ä¸€ä¸ªåŒºåŸŸâ€ã€‚
- è®°å½•å½“å‰é€‰æ‹©é¡¹
- æŒ‰ä½ SHIFT åè®°å½•é€‰æ‹©çš„æœ€åä¸€é¡¹
then æŠŠä¹‹é—´çš„å…¨éƒ¨è®¾ç½®ä¸ºé€‰ä¸­


æ‰©å±•ï¼Œå¦‚æœé€‰æ‹©é¡¹ä¸ºå…¨é€‰ï¼Œåˆ™è®¾ç½®ä¸ºå…¨ä¸é€‰

##### ä½¿ç”¨ reducer ç®¡ç†çŠ¶æ€æ›´æ–°

#### çŠ¶æ€è¿‡ç²—
å¤šä¸ªstateå…¨æ”¾åœ¨ useState ä¸­ç»´æŠ¤
- cc ä¸­ï¼š hocs
- fc ä¸­ï¼š hooks

Q:
å¤ç”¨æ€§ã€ç²¾ç®€é™ä½

#### åˆç†è®¾è®¡ç²’åº¦


### æŠ½ç¦»å…¬å…± hooks
### hooks è¸©å‘åˆ†äº«
- é—­åŒ…ï¼Œè¿”å›çš„å‡½æ•°ä¸ºä¹‹å‰çš„ï¼Œå‡½æ•°å†…ä¸èƒ½æ‹¿åˆ°å½“å‰æœ€æ–°çš„props/stateå€¼
  ```js
  const [count, setCount] = useState(0);
  useEffect(()=> {console.log(count)}, []);
  ```

## è½®å­
- [ahooks](https://ahooks.js.org/zh-CN)
- [react-use -> react hooks çš„ lodash](https://github.com/streamich/react-use)
- [react-hooks](https://github.com/ecomfe/react-hooks)

- [ç©è½¬æŸ¥è¯¢åˆ—è¡¨ useFormTableQuery](https://formilyjs.org/#/0yTeT0/zlcDcOsbhP)

## å‚è€ƒ
- [React Hooksè¸©å‘åˆ†äº«](https://www.infoq.cn/article/yQEtdq5xUPPO1ZwghSVw?utm_source=related_read_bottom&utm_medium=article)